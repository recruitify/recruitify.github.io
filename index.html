<!DOCTYPE html>
<html lang="en">
<head>
  <title>Cookie Stripe Fees Calculator</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous"> 
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.4/jquery.min.js"></script>
  <style>
    .payment-split {
      padding: 15px;
      border-radius: 5px;
      margin-bottom: 10px;
      box-shadow: 0px 2px 4px rgba(0, 0, 0, 0.1);
    }

    .payment-split .card-header {
      background-color: #e8cfcf;
      padding: 10px;
    }

    .payment-split .list-group-item {
      padding: 8px 15px;
    }

    .card-header.bg-primary {
      background-color: #4242DB!important; 
      color: white;
    }
    .card-header.bg-secondary {
      background-color: #A0A0ED!important;
      color: white;
    }
    #paymentSplitsContainer .card {
      margin-right: 20px;
    }
    .code-block pre {
      background-color: #f1f1f1!important;
      padding: 12px 6px;
      color: #1e1e87;
    }
    #explanation  {
      margin-top: 20px;
    }
    #explanation .card-body {
      font-size: 12px;
    }
  </style>
</head>
<body>
  <div class="container mt-3">
    <div class="container  mt-3 mb-4 d-flex justify-content-between align-items-center">
      <h4 class="text-center mb-4">Cookie Stripe Fees Calculator</h4>
    </div>
    <div class="row">
      <div class="col-md-3">
        <div class="card">
          <div class="card-header bg-primary">Input</div>
          <div class="card-body">
            <form>
              <div class="form-group">
                <label for="invoiceAmount">Invoice Amount:</label>
                <input type="number" id="invoiceAmount" class="form-control" Â  
   value="">
              </div>
              <div class="form-group">
                <label for="paymentSplits">Number of Payment Splits:</label>
                <input type="number" id="paymentSplits" class="form-control" value="0">
              </div>
            </form>
          </div>
        </div>
      </div>
      <div class="col-md-9">
        <div class="row">
          <div class="col-md-6">
            <div class="card">
              <div class="card-header bg-primary">Totals</div>
              <div class="card-body">
                <table class="table">
                  <tbody>
                    <tr>
                      <th>Stripe Fees Amount:</th>
                      <td><span id="stripeFeesAmount"></span></td>
                    </tr>
                    <tr>
                      <th>Cookie Fee Amount:</th>
                      <td><span id="cookieFeeAmount"></span></td>
                    </tr>
                    <tr>
                      <th>Total Fees:</th>
                      <td><span id="totalFees"></span></td>
                    </tr>
                    <tr>
                      <th>Total Final Amount:</th>
                      <td><span id="totalFinalAmount" class="fw-bold"></span></td>
                    </tr>
                  </tbody>
                </table>
              </div>
            </div>
          </div>
          <div class="col-md-6">
            <div class="card">
              <div class="card-header bg-primary">Percentage Fees</div>
              <div class="card-body">
                <table class="table">
                  <tbody>
                    <tr>
                      <th>Stripe Commission:</th>
                      <td><span id="stripeCommissionRate">2.90%</span></td>
                    </tr>
                    <tr>
                      <th>Stripe Fixed Fee:</th>
                      <td><span id="stripeFixedFee">$0.30</span></td>
                    </tr>
                    <tr>
                      <th>Cookie Fee:</th>
                      <td><span id="cookieFeeRate">1.46%</span></td>
                    </tr>
                  </tbody>
                </table>
              </div>
            </div>
          </div>
        </div>
      </div>
      <p></p>
      <p></p>
      <div class="row">
        <div class="col-md-12">
          <div id="paymentSplitsContainer" class="row row-cols-auto g-3"></div>
        </div>
      </div>
    </div>

    <div class="row">
      <div class="col-md-12">
        <div id="explanation" class="mt-4">
          <h5 class="text-center">Explanation of the Calculation</h5>
          <div class="card">
              <div class="card-body">
          <p>The calculator determines the total fees and final amount based on the following inputs:</p>
          <p>The following constants are used:</p>
                  <ul>
                      <li><b>Stripe Fee Rate:</b> 2.9% (<code class="language-markup">0.029</code> as a decimal)</li>
                      <li><b>Stripe Fixed Fee:</b> $0.30</li>
                      <li><b>Cookie Fee Rate:</b> 1.46% (<code class="language-markup">0.0146</code> as a decimal)</li>
                  </ul>
                  <p>The calculations are as follows:</p>
              <div class="highlight">
                  <div class="code-block">
                      <pre><code class="language-javascript">const totalFeeRate = stripeCommissionRate + cookieFeeRate;</code></pre>
                      <p>This calculates the combined percentage of Stripe and Cookie fees.</p>
                  </div>
              </div>
              <div class="highlight">
                  <div class="code-block">
                      <pre><code class="language-javascript">const finalAmount = roundUp(invoiceAmount / (1 - totalFeeRate), 2);</code></pre>
                      <p>This calculates the total amount the customer will actually pay, including fees.</p>
                  </div>
              </div>
              <div class="highlight">
                  <div class="code-block">
                      <pre><code class="language-javascript">const stripeFeesAmount = roundUp(stripeCommissionRate * finalAmount + stripeFixedFee, 2);</code></pre>
                      <p>This calculates the total amount of Stripe fees, including both the commission and fixed fee.</p>
                  </div>
              </div>
              <div class="highlight">
                  <div class="code-block">
                      <pre><code class="language-javascript">const cookieFeeAmount = roundUp(cookieFeeRate * finalAmount, 2);</code></pre>
                      <p>This calculates the total amount of Cookie fees.</p>
                  </div>
              </div>
              <div class="highlight">
                  <div class="code-block">
                      <pre><code class="language-javascript">const totalFees = roundUp(stripeFeesAmount + cookieFeeAmount, 2);</code></pre>
                      <p>This calculates the sum of Stripe fees and Cookie fees.</p>
                  </div>
              </div>
              <div class="highlight">
                  <div class="code-block">
                      <pre><code class="language-javascript">const totalFinalAmount = roundUp(invoiceAmount + totalFees, 2);</code></pre>
                      <p>This calculates the final amount the customer will pay, which is the invoice amount plus the total fees.</p>
                  </div>
              </div>
            <p>For each payment split, the same calculations are performed using the split invoice amount.</p>
          </div>
        </div>
      </div>
      </div>
    </div>
  </div>
  


  <script>
    function roundUp(num, places) {
      const factor = 10 ** places;
      return Math.ceil(num * factor) / factor;
    }

    $(document).ready(function() {
      $("#invoiceAmount, #paymentSplits").on("input", function() {
  var invoiceAmount = parseFloat($("#invoiceAmount").val());
  var paymentSplits = parseInt($("#paymentSplits").val());

  var stripeCommissionRate = 0.029;
  var stripeFixedFee = 0.30;
  var cookieFeeRate = 0.0146;

  var totalFeeRate = stripeCommissionRate + cookieFeeRate;
  var finalAmount = roundUp(invoiceAmount / (1 - totalFeeRate), 2);
  var stripeFeesAmount = roundUp(stripeCommissionRate * finalAmount + stripeFixedFee, 2);
  var cookieFeeAmount = roundUp(cookieFeeRate * finalAmount, 2);
  var totalFees = roundUp(stripeFeesAmount + cookieFeeAmount , 2);
  var totalFinalAmount = roundUp(invoiceAmount + totalFees, 2);

  // Update totals section
  $("#stripeFeesAmount").text("$" + stripeFeesAmount.toFixed(2));
  $("#cookieFeeAmount").text("$" + cookieFeeAmount.toFixed(2));
  $("#totalFees").text("$" + totalFees.toFixed(2));
  $("#totalFinalAmount").text("$" + totalFinalAmount.toFixed(2));

  // Update payment splits container
  $("#paymentSplitsContainer").empty();
  var splitInvoiceAmount = invoiceAmount / paymentSplits;
  for (var i = 1; i <= paymentSplits; i++) {
    var splitTotalFeeRate = stripeCommissionRate + cookieFeeRate;
    var splitFinalAmount = roundUp(splitInvoiceAmount / (1 - totalFeeRate), 2);
    var splitStripeFeesAmount = roundUp(stripeCommissionRate * splitFinalAmount + stripeFixedFee, 2);
    var splitCookieFeeAmount = roundUp(cookieFeeRate * splitFinalAmount, 2);
    var splitTotalFees = roundUp(splitStripeFeesAmount + splitCookieFeeAmount , 2);
    var splitTotalFinalAmount = roundUp(splitInvoiceAmount + splitTotalFees, 2);

    $("#paymentSplitsContainer").append(`
      <div class="card payment-split">
        <div class="card-header bg-secondary">Payment Split ${i}</div>
        <ul class="list-group list-group-flush">
          <li class="list-group-item">Invoice Amount: $${splitInvoiceAmount.toFixed(2)}</li>
          <li class="list-group-item">Stripe Fees: $${splitStripeFeesAmount.toFixed(2)}</li>
          <li class="list-group-item">Cookie Fee: $${splitCookieFeeAmount.toFixed(2)}</li>
          <li class="list-group-item">Total Fees: $${splitTotalFees.toFixed(2)}</li>
          <li class="list-group-item">Total Final Amount: $${splitTotalFinalAmount.toFixed(2)}</li>
        </ul>
      </div>
    `);
  }
});
    });
  </script>
</body>
</html>